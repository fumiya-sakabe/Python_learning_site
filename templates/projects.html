{% extends "base.html" %}

{% block title %}ミニアプリ一覧 - Python学習サイト{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>ミニアプリ一覧</h1>
        <p>実践的なプロジェクトを通じて、Pythonのスキルを向上させましょう</p>
    </div>
</div>

<section class="projects-section">
    <div class="container">
        {% if projects %}
        <div class="projects-grid">
            {% for project in projects %}
            <div class="project-card">
                <div class="project-header">
                    <h3>{{ project.title }}</h3>
                    {% if current_user.is_authenticated %}
                    <button class="favorite-btn {% if 'project:' + project.id in favorites %}active{% endif %}" 
                            data-kind="project" data-id="{{ project.id }}" 
                            title="お気に入りに追加/削除">
                        ⭐
                    </button>
                    {% endif %}
                </div>
                <p class="project-description">{{ project.get('description', '説明がありません') }}</p>
                <div class="project-id">ID: {{ project.id }}</div>
                <div class="project-actions">
                    <a class="btn btn-primary btn-sm" href="{{ url_for('project_detail', project_id=project.id) }}">このレッスンを見る</a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <p>プロジェクトがまだ追加されていません。</p>
        </div>
        {% endif %}
    </div>
</section>

<script>
// お気に入りボタンの処理
document.querySelectorAll('.favorite-btn').forEach(btn => {
    btn.addEventListener('click', async function() {
        const kind = this.dataset.kind;
        const id = this.dataset.id;
        
        try {
            const response = await fetch('/api/favorites/toggle', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ item_id: id, kind: kind })
            });
            
            const data = await response.json();
            if (data.ok) {
                if (data.is_favorite) {
                    this.classList.add('active');
                } else {
                    this.classList.remove('active');
                }
            }
        } catch (error) {
            console.error('お気に入りの更新に失敗しました:', error);
        }
    });
});
</script>
{% endblock %}

